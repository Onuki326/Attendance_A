<% if logged_in? %>
  <% provide(:title, @user.name) %>
  <div class="row">
    <table class="table table-bordered">
      <tr>
        <td>
          <%= link_to "←", user_path(date: @date.prev_month), class: "btn btn_default btn_key" %>
          <p><%= @date.strftime("%Y年%m月") %>　時間管理表</p>
          <%= link_to "→", user_path(date: @date.next_month), class: "btn btn_default btn_key" %>
        </td>
        <td width="250px">指定勤務開始時間 <%= starting_hour %><br>
                          指定勤務終了時間 <%= finishing_hour %></td>
        <td colspan="3">基本勤務時間 <%= basic_working_hour %></td>
        <td width="150px">初日<%= @fd.strftime("%m/%d") %></td>
      </tr>
      <tr>
        <td>所属　<%= @user.affiliation %></td>
        <td width="250px">氏名　<%= @user.name %></td>
        <td width="60px">コード</td>
        <td width="10px"><%= @user.employee_number %></td>
        <td width="180px">出勤日数 <%= @hours.length %>日</td>
        <td width="150px">締め<%= @ed.strftime("%m/%d") %></td>
      </tr>
    </table>
    <%= link_to "【所属長承認のお知らせ】", "#", class: "info" %><br>
    <%= link_to "【勤怠変更申請のお知らせ】", "#", class: "info" %><br>
    <%= link_to "【残業申請のお知らせ】", "#", class: "info" %><br>
    <%= link_to "勤怠を編集", edit_user_attendances_path(@user, date: @date), class: "btn btn_default" %>
    <%= link_to "CSV出力", "#", class: "btn btn_default btn_key" %><br>
    <%= link_to "勤怠修正ログ(承認済み)", "#", class: "btn btn_default btn_key block_btn" %>
    <table class="table table-bordered table-striped">
      <thead>
        <tr>
          <td rowspan="3" class="td_bottom">残業申請</td>
          <td rowspan="3" class="td_bottom">日付</td>
          <td rowspan="3" class="td_bottom">曜日</td>
          <td colspan="8">【実績】</td>
          <td colspan="12">所定外勤務</td>
        </tr>
        <tr>
          <td colspan="3">出社</td>
          <td colspan="3">退社</td>
          <td rowspan="2" class="td_bottom">在社時間</td>
          <td rowspan="2" class="td_bottom">備考</td>
          <td colspan="2">終了予定時間</td>
          <td colspan="4" rowspan="2" class="td_bottom">時間外時間</td>
          <td colspan="4" rowspan="2" class="td_bottom">業務処理内容</td>
          <td colspan="4" rowspan="2" class="td_bottom">指示者確認</td>
        </tr>
        <tr>
          <td colspan="1">時</td>
          <td colspan="1">分</td>
          <td colspan="1"></td>
          <td colspan="1">時</td>
          <td colspan="1">分</td>
          <td colspan="1"></td>
          <td colspan="1">時</td>
          <td colspan="1">分</td>
        </tr>
      </thead>
      <tbody>
      <% @d.each do |d| %>
        <tr>
          <td><%= link_to "残業申請", "#", class: "btn btn_default btn_key"%></td>
          <td><%= d.strftime("%m/%d") %></td>
          <td><%= d.strftime("#{@wd[d.wday]}") %></td>
          <td>
            <% if @user.attendances.find_by(day: d) %>
            <%= arrival_hour(d) %>
            <% end %>
          </td>
          <td>
            <% if @user.attendances.find_by(day: d) %>
            <%= arrival_min(d) %>
            <% end %>
          </td>
          <td>
            <% if d == Date.today && @user.attendances.find_by(user_id: @user, day: d).arrival.nil? %>
              <%= button_to "出社", user_attendances_path( 
                                    user_id: @user, day: @date), class: "btn btn_default btn_key" %>
            <% end %>
          </td>
          <td>
            <% if @user.attendances.find_by(day: d)  %>
            <%= leave_hour(d) %>
            <% end %>
          </td>
          <td>
            <% if @user.attendances.find_by(day: d) %>
            <%= leave_min(d) %>
            <% end %>
          </td>
          <td>
            <% if d == Date.today && Attendance.find_by(user_id: @user, day: d).arrival && Attendance.find_by(user_id: @user, day: d).leave.nil?  %>
              <%= button_to "退社", user_attendances_path( 
                                    user_id: @user, day: @date), class: "btn btn_default btn_key" %>
            <% end %>
          <td><%= duty_hour(d) %></td>
          <td></td>
          <td></td>
          <td></td>
          <td colspan="4"></td>
          <td colspan="4"></td>
          <td colspan="4"></td>
        </tr>
      <% end %>
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2"><%= basic_total_hour %></td>
          <td colspan="6"></td>
          <td rowspan="2"><%= total_hour %></td>
          <td rowspan="2"></td>
          <td rowspan="2"></td>
          <td rowspan="2"></td>
          <td colspan="4"></td>
          <td colspan="4"></td>
          <td colspan="4">
            所属長承認 未
            <%= form_for(@user) do |f| %>
              <%= f.select :name, @sperior_user.map{|t| [t.name, t.sperior]}, include_blank: true %>
              <%= f.submit "申請", class: "btn btn_default btn_key" %>
            <% end %>
          </td>
        </tr>
      </tfoot>  
    </table>
  </div>
<% else %>
  <% render "static_pages/home" %>
<% end %>